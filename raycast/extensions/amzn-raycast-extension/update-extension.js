"use strict";var Lt=Object.create;var X=Object.defineProperty;var Dt=Object.getOwnPropertyDescriptor;var kt=Object.getOwnPropertyNames;var Pt=Object.getPrototypeOf,Mt=Object.prototype.hasOwnProperty;var I=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Ft=(t,e)=>{for(var n in e)X(t,n,{get:e[n],enumerable:!0})},xe=(t,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of kt(e))!Mt.call(t,a)&&a!==n&&X(t,a,{get:()=>e[a],enumerable:!(o=Dt(e,a))||o.enumerable});return t};var O=(t,e,n)=>(n=t!=null?Lt(Pt(t)):{},xe(e||!t||!t.__esModule?X(n,"default",{value:t,enumerable:!0}):n,t)),Ut=t=>xe(X({},"__esModule",{value:!0}),t);var se=I((Qo,ze)=>{var Jt=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};ze.exports=Jt});var ie=I((Ko,Ge)=>{var Yt="2.0.0",Zt=Number.MAX_SAFE_INTEGER||9007199254740991,Qt=16,Kt=250,en=["major","premajor","minor","preminor","patch","prepatch","prerelease"];Ge.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:Qt,MAX_SAFE_BUILD_LENGTH:Kt,MAX_SAFE_INTEGER:Zt,RELEASE_TYPES:en,SEMVER_SPEC_VERSION:Yt,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var qe=I((N,je)=>{var{MAX_SAFE_COMPONENT_LENGTH:ae,MAX_SAFE_BUILD_LENGTH:tn,MAX_LENGTH:nn}=ie(),on=se();N=je.exports={};var rn=N.re=[],sn=N.safeRe=[],s=N.src=[],i=N.t={},an=0,ce="[a-zA-Z0-9-]",cn=[["\\s",1],["\\d",nn],[ce,tn]],ln=t=>{for(let[e,n]of cn)t=t.split(`${e}*`).join(`${e}{0,${n}}`).split(`${e}+`).join(`${e}{1,${n}}`);return t},p=(t,e,n)=>{let o=ln(e),a=an++;on(t,a,e),i[t]=a,s[a]=e,rn[a]=new RegExp(e,n?"g":void 0),sn[a]=new RegExp(o,n?"g":void 0)};p("NUMERICIDENTIFIER","0|[1-9]\\d*");p("NUMERICIDENTIFIERLOOSE","\\d+");p("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${ce}*`);p("MAINVERSION",`(${s[i.NUMERICIDENTIFIER]})\\.(${s[i.NUMERICIDENTIFIER]})\\.(${s[i.NUMERICIDENTIFIER]})`);p("MAINVERSIONLOOSE",`(${s[i.NUMERICIDENTIFIERLOOSE]})\\.(${s[i.NUMERICIDENTIFIERLOOSE]})\\.(${s[i.NUMERICIDENTIFIERLOOSE]})`);p("PRERELEASEIDENTIFIER",`(?:${s[i.NUMERICIDENTIFIER]}|${s[i.NONNUMERICIDENTIFIER]})`);p("PRERELEASEIDENTIFIERLOOSE",`(?:${s[i.NUMERICIDENTIFIERLOOSE]}|${s[i.NONNUMERICIDENTIFIER]})`);p("PRERELEASE",`(?:-(${s[i.PRERELEASEIDENTIFIER]}(?:\\.${s[i.PRERELEASEIDENTIFIER]})*))`);p("PRERELEASELOOSE",`(?:-?(${s[i.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${s[i.PRERELEASEIDENTIFIERLOOSE]})*))`);p("BUILDIDENTIFIER",`${ce}+`);p("BUILD",`(?:\\+(${s[i.BUILDIDENTIFIER]}(?:\\.${s[i.BUILDIDENTIFIER]})*))`);p("FULLPLAIN",`v?${s[i.MAINVERSION]}${s[i.PRERELEASE]}?${s[i.BUILD]}?`);p("FULL",`^${s[i.FULLPLAIN]}$`);p("LOOSEPLAIN",`[v=\\s]*${s[i.MAINVERSIONLOOSE]}${s[i.PRERELEASELOOSE]}?${s[i.BUILD]}?`);p("LOOSE",`^${s[i.LOOSEPLAIN]}$`);p("GTLT","((?:<|>)?=?)");p("XRANGEIDENTIFIERLOOSE",`${s[i.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);p("XRANGEIDENTIFIER",`${s[i.NUMERICIDENTIFIER]}|x|X|\\*`);p("XRANGEPLAIN",`[v=\\s]*(${s[i.XRANGEIDENTIFIER]})(?:\\.(${s[i.XRANGEIDENTIFIER]})(?:\\.(${s[i.XRANGEIDENTIFIER]})(?:${s[i.PRERELEASE]})?${s[i.BUILD]}?)?)?`);p("XRANGEPLAINLOOSE",`[v=\\s]*(${s[i.XRANGEIDENTIFIERLOOSE]})(?:\\.(${s[i.XRANGEIDENTIFIERLOOSE]})(?:\\.(${s[i.XRANGEIDENTIFIERLOOSE]})(?:${s[i.PRERELEASELOOSE]})?${s[i.BUILD]}?)?)?`);p("XRANGE",`^${s[i.GTLT]}\\s*${s[i.XRANGEPLAIN]}$`);p("XRANGELOOSE",`^${s[i.GTLT]}\\s*${s[i.XRANGEPLAINLOOSE]}$`);p("COERCEPLAIN",`(^|[^\\d])(\\d{1,${ae}})(?:\\.(\\d{1,${ae}}))?(?:\\.(\\d{1,${ae}}))?`);p("COERCE",`${s[i.COERCEPLAIN]}(?:$|[^\\d])`);p("COERCEFULL",s[i.COERCEPLAIN]+`(?:${s[i.PRERELEASE]})?(?:${s[i.BUILD]})?(?:$|[^\\d])`);p("COERCERTL",s[i.COERCE],!0);p("COERCERTLFULL",s[i.COERCEFULL],!0);p("LONETILDE","(?:~>?)");p("TILDETRIM",`(\\s*)${s[i.LONETILDE]}\\s+`,!0);N.tildeTrimReplace="$1~";p("TILDE",`^${s[i.LONETILDE]}${s[i.XRANGEPLAIN]}$`);p("TILDELOOSE",`^${s[i.LONETILDE]}${s[i.XRANGEPLAINLOOSE]}$`);p("LONECARET","(?:\\^)");p("CARETTRIM",`(\\s*)${s[i.LONECARET]}\\s+`,!0);N.caretTrimReplace="$1^";p("CARET",`^${s[i.LONECARET]}${s[i.XRANGEPLAIN]}$`);p("CARETLOOSE",`^${s[i.LONECARET]}${s[i.XRANGEPLAINLOOSE]}$`);p("COMPARATORLOOSE",`^${s[i.GTLT]}\\s*(${s[i.LOOSEPLAIN]})$|^$`);p("COMPARATOR",`^${s[i.GTLT]}\\s*(${s[i.FULLPLAIN]})$|^$`);p("COMPARATORTRIM",`(\\s*)${s[i.GTLT]}\\s*(${s[i.LOOSEPLAIN]}|${s[i.XRANGEPLAIN]})`,!0);N.comparatorTrimReplace="$1$2$3";p("HYPHENRANGE",`^\\s*(${s[i.XRANGEPLAIN]})\\s+-\\s+(${s[i.XRANGEPLAIN]})\\s*$`);p("HYPHENRANGELOOSE",`^\\s*(${s[i.XRANGEPLAINLOOSE]})\\s+-\\s+(${s[i.XRANGEPLAINLOOSE]})\\s*$`);p("STAR","(<|>)?=?\\s*\\*");p("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");p("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var _e=I((er,He)=>{var pn=Object.freeze({loose:!0}),dn=Object.freeze({}),mn=t=>t?typeof t!="object"?pn:t:dn;He.exports=mn});var Be=I((tr,Ve)=>{var Xe=/^[0-9]+$/,We=(t,e)=>{let n=Xe.test(t),o=Xe.test(e);return n&&o&&(t=+t,e=+e),t===e?0:n&&!o?-1:o&&!n?1:t<e?-1:1},un=(t,e)=>We(e,t);Ve.exports={compareIdentifiers:We,rcompareIdentifiers:un}});var pe=I((nr,Qe)=>{var Y=se(),{MAX_LENGTH:Je,MAX_SAFE_INTEGER:Z}=ie(),{safeRe:Ye,t:Ze}=qe(),hn=_e(),{compareIdentifiers:G}=Be(),le=class t{constructor(e,n){if(n=hn(n),e instanceof t){if(e.loose===!!n.loose&&e.includePrerelease===!!n.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Je)throw new TypeError(`version is longer than ${Je} characters`);Y("SemVer",e,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;let o=e.trim().match(n.loose?Ye[Ze.LOOSE]:Ye[Ze.FULL]);if(!o)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+o[1],this.minor=+o[2],this.patch=+o[3],this.major>Z||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Z||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Z||this.patch<0)throw new TypeError("Invalid patch version");o[4]?this.prerelease=o[4].split(".").map(a=>{if(/^[0-9]+$/.test(a)){let r=+a;if(r>=0&&r<Z)return r}return a}):this.prerelease=[],this.build=o[5]?o[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Y("SemVer.compare",this.version,this.options,e),!(e instanceof t)){if(typeof e=="string"&&e===this.version)return 0;e=new t(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof t||(e=new t(e,this.options)),G(this.major,e.major)||G(this.minor,e.minor)||G(this.patch,e.patch)}comparePre(e){if(e instanceof t||(e=new t(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let n=0;do{let o=this.prerelease[n],a=e.prerelease[n];if(Y("prerelease compare",n,o,a),o===void 0&&a===void 0)return 0;if(a===void 0)return 1;if(o===void 0)return-1;if(o===a)continue;return G(o,a)}while(++n)}compareBuild(e){e instanceof t||(e=new t(e,this.options));let n=0;do{let o=this.build[n],a=e.build[n];if(Y("prerelease compare",n,o,a),o===void 0&&a===void 0)return 0;if(a===void 0)return 1;if(o===void 0)return-1;if(o===a)continue;return G(o,a)}while(++n)}inc(e,n,o){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",n,o);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",n,o);break;case"prepatch":this.prerelease.length=0,this.inc("patch",n,o),this.inc("pre",n,o);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",n,o),this.inc("pre",n,o);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let a=Number(o)?1:0;if(!n&&o===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[a];else{let r=this.prerelease.length;for(;--r>=0;)typeof this.prerelease[r]=="number"&&(this.prerelease[r]++,r=-2);if(r===-1){if(n===this.prerelease.join(".")&&o===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(a)}}if(n){let r=[n,a];o===!1&&(r=[n]),G(this.prerelease[0],n)===0?isNaN(this.prerelease[1])&&(this.prerelease=r):this.prerelease=r}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};Qe.exports=le});var de=I((or,et)=>{var Ke=pe(),fn=(t,e,n=!1)=>{if(t instanceof Ke)return t;try{return new Ke(t,e)}catch(o){if(!n)return null;throw o}};et.exports=fn});var nt=I((rr,tt)=>{var gn=de(),En=(t,e)=>{let n=gn(t.trim().replace(/^[=v]+/,""),e);return n?n.version:null};tt.exports=En});var Q=I((sr,rt)=>{var ot=pe(),yn=(t,e,n)=>new ot(t,n).compare(new ot(e,n));rt.exports=yn});var it=I((ir,st)=>{var wn=Q(),xn=(t,e,n)=>wn(t,e,n)>0;st.exports=xn});var ct=I((ar,at)=>{var In=Q(),$n=(t,e,n)=>In(t,e,n)<0;at.exports=$n});var pt=I((cr,lt)=>{var bn=Q(),An=(t,e,n)=>bn(t,e,n)<=0;lt.exports=An});var mt=I((lr,dt)=>{var vn=de(),Sn=(t,e)=>{let n=vn(t,e);return n?n.version:null};dt.exports=Sn});var Un={};Ft(Un,{default:()=>Ot});module.exports=Ut(Un);var Fe=O(require("os"),1);var W=t=>{try{if(typeof t=="string"){let e=JSON.parse(t);if(e&&typeof e=="object")return!0}}catch{}return!1},te=t=>Array.isArray(t)?t.filter(e=>!!e):[];var ke=require("child_process"),Pe=require("util");var zt=require("@raycast/api");var C=require("@raycast/api"),ne=class{toast;abortable;_abortController;constructor(e){this.abortable=e.abortable,this.toast=C.environment.launchType===C.LaunchType.UserInitiated?new C.Toast(e):void 0,this.updateAbortAction()}updateAbortAction(){this.toast&&(this._abortController=this.abortable?new AbortController:void 0,this.toast.primaryAction=this.abortable?{title:"Cancel",onAction:()=>{console.warn("Aborting..."),this._abortController?.abort()}}:void 0)}updateContent(e){if(this.toast){let{title:n,style:o,message:a,secondaryAction:r}=this.toast;this.toast.title=e.title??n,this.toast.style=e.style??o,this.toast.message=e.message??a,this.abortable=e.abortable??this.abortable,this.toast.secondaryAction=e.secondaryAction??r,this.updateAbortAction()}}show(){return this.toast?this.toast.show():Promise.resolve()}hide(){return this.toast?this.toast.hide():Promise.resolve()}get abortController(){return this._abortController}},oe=async t=>{let e=new ne(t);return await e.show(),e};var Ie=O(require("os"),1);var{username:Xn}=Ie.default.userInfo();var re=require("@raycast/api");function f(t){let e=Object.prototype.toString.call(t);return t instanceof Date||typeof t=="object"&&e==="[object Date]"?new t.constructor(+t):typeof t=="number"||e==="[object Number]"||typeof t=="string"||e==="[object String]"?new Date(t):new Date(NaN)}function v(t,e){return t instanceof Date?new t.constructor(e):new Date(e)}function $e(t,e){let n=f(t);return isNaN(e)?v(t,NaN):(e&&n.setDate(n.getDate()+e),n)}function be(t,e){let n=f(t);if(isNaN(e))return v(t,NaN);if(!e)return n;let o=n.getDate(),a=v(t,n.getTime());a.setMonth(n.getMonth()+e+1,0);let r=a.getDate();return o>=r?a:(n.setFullYear(a.getFullYear(),a.getMonth(),o),n)}function Ae(t,e){let{years:n=0,months:o=0,weeks:a=0,days:r=0,hours:l=0,minutes:c=0,seconds:w=0}=e,g=f(t),m=o||n?be(g,o+n*12):g,E=r||a?$e(m,r+a*7):m,x=c+l*60,k=(w+x*60)*1e3;return v(t,E.getTime()+k)}function ve(t,e){let n=+f(t);return v(t,n+e)}var Gt=Math.pow(10,8)*24*60*60*1e3,lo=-Gt;var Se=6e4;var jt=3600;var Re=jt*24,po=Re*7,qt=Re*365.2425,Ht=qt/12,mo=Ht*3;function Ne(t,e){return ve(t,e*Se)}function S(t,e){let n=t<0?"-":"",o=Math.abs(t).toString().padStart(e,"0");return n+o}function Te(t,e){let n=f(t);if(isNaN(n.getTime()))throw new RangeError("Invalid time value");let o=e?.format??"extended",a=e?.representation??"complete",r="",l="",c=o==="extended"?"-":"",w=o==="extended"?":":"";if(a!=="time"){let g=S(n.getDate(),2),m=S(n.getMonth()+1,2);r=`${S(n.getFullYear(),4)}${c}${m}${c}${g}`}if(a!=="date"){let g=n.getTimezoneOffset();if(g!==0){let T=Math.abs(g),$=S(Math.trunc(T/60),2),j=S(T%60,2);l=`${g<0?"+":"-"}${$}:${j}`}else l="Z";let m=S(n.getHours(),2),E=S(n.getMinutes(),2),x=S(n.getSeconds(),2),b=r===""?"":"T",k=[m,E,x].join(w);r=`${r}${b}${k}${l}`}return r}function Oe(t){return f(t*1e3)}function Ce(t){return Math.trunc(+f(t)/1e3)}function V(t,e){let n=f(t),o=f(e);return n.getTime()>o.getTime()}var R=require("fs"),Le=require("path"),z=class t{static path=(e,n=!0)=>{let{supportPath:o,commandName:a}=re.environment;return(0,Le.join)(o,`${n?`${a}-${e}`:e}.json`)};static clear=(e,n)=>{let o=t.path(e,n);return(0,R.existsSync)(o)?((0,R.unlinkSync)(o),!0):!1};static store=(e,n,o={})=>{try{let{appendCommand:a=!0,ttl:r}=o,l=t.path(e,a),c={...r?{ttl:Ce(Ae(new Date,r))}:{},data:n};(0,R.writeFileSync)(l,JSON.stringify(c))}catch{return!1}return!0};static retrieve=(e,n={})=>{let{appendCommand:o=!0}=n,a=t.path(e,o);if(!(0,R.existsSync)(a))return;let r=(0,R.readFileSync)(a,"utf8"),l=JSON.parse(r);if(l.ttl&&V(new Date,Oe(+l.ttl))){this.clear(e,o);return}return l.data}};var _t=t=>t==null?"":String(t),De=t=>t instanceof Error?t.message:_t(t);var h=(0,Pe.promisify)(ke.exec),U=t=>typeof t=="object"&&"stderr"in t?t.stderr:De(t);var Me=`${Fe.default.homedir()}/.midway/cookie`,Xt=t=>typeof t=="object"&&t!==null&&"__type"in t&&t.__type.includes("Exception"),Wt=t=>typeof t=="object"&&t!==null&&"status"in t&&t.status==="error",Vt=(t,e)=>{let{cookie:n,data:o,args:a=[],headers:r={},method:l,maxBuffer:c,cancel:w}=e,g=[`curl -sSL '${t}'`,`-X ${l??"GET"}`,Object.entries(r).map(([m,E])=>`-H '${m}: ${E}'`),a,o?[`-d '${JSON.stringify(o)}'`]:[],n?[`-b '${Object.entries(n).map(([m,E])=>`${m}=${E}`).join(";")}'`]:[]].flat();return h(g.join(" "),{maxBuffer:c,signal:w?.signal}).then(({stdout:m})=>W(m)?JSON.parse(m):m).catch(m=>{throw new Error(U(m))})};var L=(t,e={})=>{let{ignoreCoralError:n=!1,writeToCookieFile:o=!0,args:a=[],...r}=e,l=[a,`--anyauth --location-trusted -k -u : -b ${Me}`,o?[`-c ${Me}`]:[]].flat();return Vt(t,{...r,args:l}).then(c=>{if(!n&&Xt(c))throw new Error(`${c.__type}${c.message?`: ${c.message}`:""}`);if(Wt(c))throw new Error(`${c.message??"Midway Error"}: ${c.desc??"You should authenticate (may use mwinit)"}`);return c})};var Bt=(t,e)=>L("https://gitfarm-sso.corp.amazon.com",{...e,method:"POST",headers:{"Content-Encoding":"amz-1.0","Content-Type":"application/json; charset=UTF-8","X-Amz-Target":`com.amazon.brazil.gitfarm.service.GitFarmService.${t}`}}),Ue=t=>Bt("getReferenceSha1s",{data:{repositoryId:t}}).then(e=>e.references);var B=require("@raycast/api");function J(t,e=!0){let{launchType:n,extensionName:o,commandName:a}=B.environment;return!e||n===B.LaunchType.Background?Promise.resolve():L("https://analytics.raycast.tools.aws.dev/v2/stats",{method:"POST",headers:{"Content-Type":"application/json; charset=UTF-8"},data:{commandName:a,extensionVersion:t,extensionName:o}}).catch(r=>console.warn(`Failed to publish stats for ${o}/${a}.`,r))}var d=require("@raycast/api"),ft=require("child_process");var y=require("fs"),K=O(require("os"),1),D=require("path"),me=O(nt(),1),gt=O(it(),1),Et=O(ct(),1),ue=O(pt(),1),yt=O(mt(),1);var wt=t=>{try{return!t||!(0,y.existsSync)(t)||!(0,y.lstatSync)(t).isDirectory()?!1:((0,y.accessSync)(t,y.constants.W_OK),!0)}catch{return!1}},xt=t=>{let e=(0,D.join)(d.environment.assetsPath,t);if(!(0,y.existsSync)(e))return;let n=(0,y.readFileSync)(e,{encoding:"utf8"});return W(n)?JSON.parse(n):void 0},It="workspace-config.json",$t=()=>xt(It)?.workspacePath,Rn=()=>{let t=$t(),e=t&&(0,D.join)(t,"../../..");return wt(e)?e:void 0},he="artifact-extr-config.json",bt=()=>{let t=xt(he)?.artifactExtrPath;return wt(t)?t:void 0},At=t=>Ue(`pkg/${t}`).then(e=>te(e).map(n=>(n.name.match(/refs\/tags\/(.*)/)??["",""])[1]).filter(n=>(0,yt.default)(n))).then(e=>e.length===0?void 0:e.reduce((n,o)=>(0,gt.default)(o,n)?o:n,e[0])).catch(e=>{console.warn(`Failed to get the latest extension version for ${t}.`,e)});var fe="status-v3",ut=t=>{z.store(fe,t)},Nn=()=>z.retrieve(fe),ht=()=>z.clear(fe),vt=async({mode:t,...e})=>t==="artifact"?On(e):Tn(e),Tn=async t=>{let{currentVersion:e,workspaceName:n,pkg:o,tmpOutputPath:a}=t,r="\u{1F516} Fetching the latest version...",l=await oe({style:d.Toast.Style.Animated,title:r}),c=await At(o);if(!c){l.updateContent({style:d.Toast.Style.Failure,title:"\u274C Failed to get the latest version."});return}if((0,ue.default)(c,e)){l.updateContent({style:d.Toast.Style.Success,title:`\u{1F389} ${c} is the latest version.`}),await(0,d.updateCommandMetadata)({subtitle:`\u{1F389}  up to date with ${c}`});return}await(0,d.updateCommandMetadata)({subtitle:`\u2728  new version ${c} available!`});let w=new Date,g=w.getTime(),m=Nn(),E=(m?.retryAttempts||0)+1,x=5;if(m){if((0,Et.default)(m.version,c)||m.status==="in-progress"&&V(w,Ne(new Date(m.timestamp),30)))m=void 0,ht();else if(m.status==="in-progress"){r=`Update in progress for the latest version ${c}. Please wait and retry later.`,l.updateContent({style:d.Toast.Style.Failure,title:r});return}}let b="brazil",k=`${b}-build`,T=K.default.homedir(),$=["/usr/gnu/bin","/usr/local/bin","/opt/homebrew/bin","/bin","/usr/bin",".",`${T}/.toolbox/bin`,`${T}/.local/share/rtx/shims`,`${T}/.local/share/mise/shims`,`${T}/.asdf/shims`].join(":"),j=Rn();if(!j){r=`\u274C Failed to update extension from source code, as ${j} is invalid.`,l.updateContent({title:r,style:d.Toast.Style.Failure});return}let P=(0,D.join)(j,n),q=(0,D.join)(P,"src",o),H=`sudo -u ${K.default.userInfo().username}`,Ee=`${a}/update-extension.txt`;await h(`mkdir -p ${a}`);let u=A=>`${A} 2>&1 | tee -a ${Ee}`,M=A=>`(${u(A)}; exit \${PIPESTATUS[0]};)`;r="\u{1F44B} Starting extension update process...",l.updateContent({title:r,style:d.Toast.Style.Animated,abortable:!0,message:`Progress can be tracked by tailing ${Ee}`});try{if(await h([u(`echo "${r}"`),u(`echo "    Start time: ${Te(w)}"`),u(`echo "    Current version: ${(0,me.default)(e)}"`),u(`echo "    Latest version: ${(0,me.default)(c)}"`),u(`echo "    Retry Attempts: ${E} / ${x}"`)].join(" && "),{env:{PATH:$}}),!m||m.status==="failed"&&E<=x||d.environment.launchType===d.LaunchType.UserInitiated){ut({version:c,status:"in-progress",timestamp:g,retryAttempts:E}),await(0,d.updateCommandMetadata)({subtitle:`\u{1F6A7}  updating extension to ${c}...`}),r=`\u{1F527} Initializing workspace for ${c}...`,l.updateContent({title:r}),await h([u(`echo "${r}"`),M(`[[ -d "${P}" ]] || ${H} ${b} ws create -r ${P} -vs AmznRaycastExtension/development`),u('echo "\u{1F37B} Workspace initialized successfully!"')].join(" && "),{signal:l.abortController?.signal,env:{PATH:$}}),r="\u{1F504} Syncing workspace...",l.updateContent({title:r}),await h([`cd ${P}`,u(`echo "${r}"`),M(`${H} ${b} ws --sync --md`),u(`echo "\u{1F37B} Workspace ${n} synced successfully!"`)].join(" && "),{signal:l.abortController?.signal,env:{PATH:$}}),r="\u{1F47E} Cloning extension package...",l.updateContent({title:r}),await h([`cd ${P}`,u(`echo "${r}"`),M(`[[ -d "${q}" ]] || ${H} ${b} ws use -p ${o}`),u(`echo "\u{1F37B} Extension package ${o} cloned successfully!"`)].join(" && "),{signal:l.abortController?.signal,env:{PATH:$}}),r=`\u{1F516} Switching to the latest version (${c})...`,l.updateContent({title:r}),await h([`cd ${q}`,u(`echo "\u{1F516} Fetching the latest version for ${o}..."`),M("git fetch"),u(`echo "${r}"`),M(`git checkout "refs/tags/${c}" -b ${c}-${g}`),u(`echo "\u{1F37B} Switched to latest version ${c} successfully!"`)].join(" && "),{signal:l.abortController?.signal,env:{PATH:$}});let A=async(F,_)=>{r=_,l.updateContent({title:r}),await h([`cd ${q}`,u(`echo "${_}"`),M(`${H} ${k} ci --omit=dev ${F?"--prefer-offline":""}  --no-audit`),u('echo "\u{1F37B} Dependencies installed successfully!"')].join(" && "),{signal:l.abortController?.signal,env:{PATH:$}})};try{await A(!0,"\u{1F4E6} Installing dependencies...")}catch(F){if(l.abortController?.signal.aborted)throw F;console.warn("Failed to install deps: ",F),await A(!1,'\u{1F4E6} Retrying dependencies installation without "--prefer-offline"...')}let ye=bt();ye&&(0,y.writeFileSync)(`${q}/assets/${he}`,JSON.stringify({artifactExtrPath:ye})),r="\u{1F6A7} Deploying the latest changes in development mode...",l.updateContent({title:r}),await h(u(`echo "${r}"`),{env:{PATH:$}}),await new Promise((F,_)=>{let ee=(0,ft.spawn)([`cd ${q}`,`${H} ${k} run dev`].join(" && "),{shell:!0,signal:l.abortController?.signal,env:{PATH:$},timeout:12e3});ee.stdout.on("data",we=>{we.toString().includes("built extension successfully")&&ee.kill("SIGUSR1")}),ee.on("exit",(we,Ct)=>{Ct==="SIGUSR1"?F():_(new Error("Failed to deploy the latest changes in development mode."))})}),await h([u('echo "\u2728 You are up to update!"'),u('echo "    For any issues you encounter, please refer to "'),u('echo "      https://w.amazon.com/bin/view/UsingRaycast/AmznRaycastExtension/InstallFromSourceCode#HTroubleshooting"')].join(" && "),{env:{PATH:$}}),l.updateContent({style:d.Toast.Style.Success,title:`\u2728 Updated extension to ${c}.`,abortable:!1}),await(0,d.updateCommandMetadata)({subtitle:`\u{1F389}  up to date with ${c}`}),ht()}}catch(A){console.error("Failed to update extension: ",A),r=`\u274C Failed to update extension to ${c}.`,l.updateContent({style:d.Toast.Style.Failure,title:r,message:U(A),abortable:!1}),ut({timestamp:g,version:c,status:"failed",retryAttempts:E}),await h(u(`echo "${r}"`),{env:{PATH:$}}),await(0,d.updateCommandMetadata)({subtitle:`\u{1F480}  failed to update extension to ${c}`})}},On=async t=>{let{currentVersion:e,pkg:n,tmpOutputPath:o,workspaceName:a}=t,r="\u{1F516} Fetching the latest version...",l=await oe({title:r,style:d.Toast.Style.Animated,abortable:!1}),c=await At(n);if(!c)l.updateContent({style:d.Toast.Style.Failure,title:"\u274C Failed to get the latest version."});else if((0,ue.default)(c,e))l.updateContent({style:d.Toast.Style.Success,title:`\u{1F389} ${c} is the latest version.`}),await(0,d.updateCommandMetadata)({subtitle:`\u{1F389}  up to date with ${c}`});else if(await(0,d.updateCommandMetadata)({subtitle:`\u2728  new version ${c} available!`}),d.environment.launchType===d.LaunchType.UserInitiated)try{let w=Date.now(),g=`${c}-${w}.zip`,m=(0,D.join)(o,g);r="\u{1F4E5} Retrieving the source code zip file for extension...",l.updateContent({title:r,abortable:!0}),await h(`mkdir -p ${o}`),await L(`https://code.amazon.com/packages/${n}/blobs/mainline/--/archives/latest.zip/?download=1`,{args:[`-o ${m}`],cancel:l.abortController});let E=bt()??K.default.homedir(),x=(0,D.join)(E,a);r=`\u{1F4E6} Extracting the source code zip file to ${x}/latest...`,l.updateContent({title:r,abortable:!1}),await h(`mkdir -p ${x} && unzip -q -o ${m} -d ${x}/latest`,{signal:l.abortController?.signal}),(0,y.writeFileSync)(`${x}/latest/assets/${he}`,JSON.stringify({artifactExtrPath:E}));let b=$t();b&&(0,y.writeFileSync)(`${x}/latest/assets/${It}`,JSON.stringify({workspacePath:b})),await h(`rm -f ${m}`),r=`\u{1F4C2} Launching "Import Extension" to access the ${x}/latest directory...`,l.updateContent({title:r}),await(0,d.launchCommand)({name:"import-extension",extensionName:"developer",ownerOrAuthorName:"raycast",type:d.LaunchType.UserInitiated}),await(0,d.updateCommandMetadata)({subtitle:`\u{1F389}  up to date with ${c}`})}catch(w){console.error("Failed to update extension: ",w),r=`\u274C Failed to update extension to ${c}.`,l.updateContent({style:d.Toast.Style.Failure,title:r,message:U(w),abortable:!1})}};var St="1.18.2";var ge=St,Ln="AmznRaycastExtension",Dn=".managed-amzn-raycast-do-not-modify-or-delete",kn="managed-amzn-raycast-do-not-delete",Pn="/tmp/amzn-raycast-extension";var Rt=t=>vt({currentVersion:ge,pkg:Ln,tmpOutputPath:Pn,mode:t,workspaceName:t==="artifact"?kn:Dn});var Mn=()=>J(ge,!0),Nt=Mn;var Tt=require("@raycast/api"),{"extension-update-method":Fn}=(0,Tt.getPreferenceValues)();async function Ot(){await Nt(),await Rt(Fn)}
