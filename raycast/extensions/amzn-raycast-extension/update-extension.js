"use strict";var Yt=Object.create;var X=Object.defineProperty;var Kt=Object.getOwnPropertyDescriptor;var Zt=Object.getOwnPropertyNames;var Qt=Object.getPrototypeOf,eo=Object.prototype.hasOwnProperty;var I=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),to=(e,t)=>{for(var o in t)X(e,o,{get:t[o],enumerable:!0})},Se=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Zt(t))!eo.call(e,s)&&s!==o&&X(e,s,{get:()=>t[s],enumerable:!(r=Kt(t,s))||r.enumerable});return e};var L=(e,t,o)=>(o=e!=null?Yt(Qt(e)):{},Se(t||!e||!e.__esModule?X(o,"default",{value:e,enumerable:!0}):o,e)),oo=e=>Se(X({},"__esModule",{value:!0}),e);var le=I((cs,rt)=>{var Do=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};rt.exports=Do});var fe=I((ps,at)=>{var Po="2.0.0",Mo=Number.MAX_SAFE_INTEGER||9007199254740991,Fo=16,jo=250,Uo=["major","premajor","minor","preminor","patch","prepatch","prerelease"];at.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:Fo,MAX_SAFE_BUILD_LENGTH:jo,MAX_SAFE_INTEGER:Mo,RELEASE_TYPES:Uo,SEMVER_SPEC_VERSION:Po,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var nt=I((T,st)=>{var{MAX_SAFE_COMPONENT_LENGTH:ce,MAX_SAFE_BUILD_LENGTH:zo,MAX_LENGTH:Go}=fe(),qo=le();T=st.exports={};var Wo=T.re=[],Ho=T.safeRe=[],n=T.src=[],i=T.t={},_o=0,pe="[a-zA-Z0-9-]",Bo=[["\\s",1],["\\d",Go],[pe,zo]],Xo=e=>{for(let[t,o]of Bo)e=e.split(`${t}*`).join(`${t}{0,${o}}`).split(`${t}+`).join(`${t}{1,${o}}`);return e},c=(e,t,o)=>{let r=Xo(t),s=_o++;qo(e,s,t),i[e]=s,n[s]=t,Wo[s]=new RegExp(t,o?"g":void 0),Ho[s]=new RegExp(r,o?"g":void 0)};c("NUMERICIDENTIFIER","0|[1-9]\\d*");c("NUMERICIDENTIFIERLOOSE","\\d+");c("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${pe}*`);c("MAINVERSION",`(${n[i.NUMERICIDENTIFIER]})\\.(${n[i.NUMERICIDENTIFIER]})\\.(${n[i.NUMERICIDENTIFIER]})`);c("MAINVERSIONLOOSE",`(${n[i.NUMERICIDENTIFIERLOOSE]})\\.(${n[i.NUMERICIDENTIFIERLOOSE]})\\.(${n[i.NUMERICIDENTIFIERLOOSE]})`);c("PRERELEASEIDENTIFIER",`(?:${n[i.NUMERICIDENTIFIER]}|${n[i.NONNUMERICIDENTIFIER]})`);c("PRERELEASEIDENTIFIERLOOSE",`(?:${n[i.NUMERICIDENTIFIERLOOSE]}|${n[i.NONNUMERICIDENTIFIER]})`);c("PRERELEASE",`(?:-(${n[i.PRERELEASEIDENTIFIER]}(?:\\.${n[i.PRERELEASEIDENTIFIER]})*))`);c("PRERELEASELOOSE",`(?:-?(${n[i.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${n[i.PRERELEASEIDENTIFIERLOOSE]})*))`);c("BUILDIDENTIFIER",`${pe}+`);c("BUILD",`(?:\\+(${n[i.BUILDIDENTIFIER]}(?:\\.${n[i.BUILDIDENTIFIER]})*))`);c("FULLPLAIN",`v?${n[i.MAINVERSION]}${n[i.PRERELEASE]}?${n[i.BUILD]}?`);c("FULL",`^${n[i.FULLPLAIN]}$`);c("LOOSEPLAIN",`[v=\\s]*${n[i.MAINVERSIONLOOSE]}${n[i.PRERELEASELOOSE]}?${n[i.BUILD]}?`);c("LOOSE",`^${n[i.LOOSEPLAIN]}$`);c("GTLT","((?:<|>)?=?)");c("XRANGEIDENTIFIERLOOSE",`${n[i.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);c("XRANGEIDENTIFIER",`${n[i.NUMERICIDENTIFIER]}|x|X|\\*`);c("XRANGEPLAIN",`[v=\\s]*(${n[i.XRANGEIDENTIFIER]})(?:\\.(${n[i.XRANGEIDENTIFIER]})(?:\\.(${n[i.XRANGEIDENTIFIER]})(?:${n[i.PRERELEASE]})?${n[i.BUILD]}?)?)?`);c("XRANGEPLAINLOOSE",`[v=\\s]*(${n[i.XRANGEIDENTIFIERLOOSE]})(?:\\.(${n[i.XRANGEIDENTIFIERLOOSE]})(?:\\.(${n[i.XRANGEIDENTIFIERLOOSE]})(?:${n[i.PRERELEASELOOSE]})?${n[i.BUILD]}?)?)?`);c("XRANGE",`^${n[i.GTLT]}\\s*${n[i.XRANGEPLAIN]}$`);c("XRANGELOOSE",`^${n[i.GTLT]}\\s*${n[i.XRANGEPLAINLOOSE]}$`);c("COERCEPLAIN",`(^|[^\\d])(\\d{1,${ce}})(?:\\.(\\d{1,${ce}}))?(?:\\.(\\d{1,${ce}}))?`);c("COERCE",`${n[i.COERCEPLAIN]}(?:$|[^\\d])`);c("COERCEFULL",n[i.COERCEPLAIN]+`(?:${n[i.PRERELEASE]})?(?:${n[i.BUILD]})?(?:$|[^\\d])`);c("COERCERTL",n[i.COERCE],!0);c("COERCERTLFULL",n[i.COERCEFULL],!0);c("LONETILDE","(?:~>?)");c("TILDETRIM",`(\\s*)${n[i.LONETILDE]}\\s+`,!0);T.tildeTrimReplace="$1~";c("TILDE",`^${n[i.LONETILDE]}${n[i.XRANGEPLAIN]}$`);c("TILDELOOSE",`^${n[i.LONETILDE]}${n[i.XRANGEPLAINLOOSE]}$`);c("LONECARET","(?:\\^)");c("CARETTRIM",`(\\s*)${n[i.LONECARET]}\\s+`,!0);T.caretTrimReplace="$1^";c("CARET",`^${n[i.LONECARET]}${n[i.XRANGEPLAIN]}$`);c("CARETLOOSE",`^${n[i.LONECARET]}${n[i.XRANGEPLAINLOOSE]}$`);c("COMPARATORLOOSE",`^${n[i.GTLT]}\\s*(${n[i.LOOSEPLAIN]})$|^$`);c("COMPARATOR",`^${n[i.GTLT]}\\s*(${n[i.FULLPLAIN]})$|^$`);c("COMPARATORTRIM",`(\\s*)${n[i.GTLT]}\\s*(${n[i.LOOSEPLAIN]}|${n[i.XRANGEPLAIN]})`,!0);T.comparatorTrimReplace="$1$2$3";c("HYPHENRANGE",`^\\s*(${n[i.XRANGEPLAIN]})\\s+-\\s+(${n[i.XRANGEPLAIN]})\\s*$`);c("HYPHENRANGELOOSE",`^\\s*(${n[i.XRANGEPLAINLOOSE]})\\s+-\\s+(${n[i.XRANGEPLAINLOOSE]})\\s*$`);c("STAR","(<|>)?=?\\s*\\*");c("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");c("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var lt=I((ds,it)=>{var Vo=Object.freeze({loose:!0}),Jo=Object.freeze({}),Yo=e=>e?typeof e!="object"?Vo:e:Jo;it.exports=Yo});var dt=I((ms,pt)=>{var ft=/^[0-9]+$/,ct=(e,t)=>{let o=ft.test(e),r=ft.test(t);return o&&r&&(e=+e,t=+t),e===t?0:o&&!r?-1:r&&!o?1:e<t?-1:1},Ko=(e,t)=>ct(t,e);pt.exports={compareIdentifiers:ct,rcompareIdentifiers:Ko}});var me=I((us,xt)=>{var Z=le(),{MAX_LENGTH:mt,MAX_SAFE_INTEGER:Q}=fe(),{safeRe:ut,t:ht}=nt(),Zo=lt(),{compareIdentifiers:G}=dt(),de=class e{constructor(t,o){if(o=Zo(o),t instanceof e){if(t.loose===!!o.loose&&t.includePrerelease===!!o.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof t}".`);if(t.length>mt)throw new TypeError(`version is longer than ${mt} characters`);Z("SemVer",t,o),this.options=o,this.loose=!!o.loose,this.includePrerelease=!!o.includePrerelease;let r=t.trim().match(o.loose?ut[ht.LOOSE]:ut[ht.FULL]);if(!r)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>Q||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Q||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Q||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){let a=+s;if(a>=0&&a<Q)return a}return s}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(Z("SemVer.compare",this.version,this.options,t),!(t instanceof e)){if(typeof t=="string"&&t===this.version)return 0;t=new e(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof e||(t=new e(t,this.options)),G(this.major,t.major)||G(this.minor,t.minor)||G(this.patch,t.patch)}comparePre(t){if(t instanceof e||(t=new e(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let o=0;do{let r=this.prerelease[o],s=t.prerelease[o];if(Z("prerelease compare",o,r,s),r===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(r===void 0)return-1;if(r===s)continue;return G(r,s)}while(++o)}compareBuild(t){t instanceof e||(t=new e(t,this.options));let o=0;do{let r=this.build[o],s=t.build[o];if(Z("build compare",o,r,s),r===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(r===void 0)return-1;if(r===s)continue;return G(r,s)}while(++o)}inc(t,o,r){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",o,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",o,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",o,r),this.inc("pre",o,r);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",o,r),this.inc("pre",o,r);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let s=Number(r)?1:0;if(!o&&r===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[s];else{let a=this.prerelease.length;for(;--a>=0;)typeof this.prerelease[a]=="number"&&(this.prerelease[a]++,a=-2);if(a===-1){if(o===this.prerelease.join(".")&&r===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(s)}}if(o){let a=[o,s];r===!1&&(a=[o]),G(this.prerelease[0],o)===0?isNaN(this.prerelease[1])&&(this.prerelease=a):this.prerelease=a}break}default:throw new Error(`invalid increment argument: ${t}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};xt.exports=de});var ue=I((hs,yt)=>{var gt=me(),Qo=(e,t,o=!1)=>{if(e instanceof gt)return e;try{return new gt(e,t)}catch(r){if(!o)return null;throw r}};yt.exports=Qo});var wt=I((xs,Et)=>{var er=ue(),tr=(e,t)=>{let o=er(e.trim().replace(/^[=v]+/,""),t);return o?o.version:null};Et.exports=tr});var ee=I((gs,bt)=>{var It=me(),or=(e,t,o)=>new It(e,o).compare(new It(t,o));bt.exports=or});var $t=I((ys,St)=>{var rr=ee(),ar=(e,t,o)=>rr(e,t,o)>0;St.exports=ar});var At=I((Es,vt)=>{var sr=ee(),nr=(e,t,o)=>sr(e,t,o)<0;vt.exports=nr});var Nt=I((ws,Rt)=>{var ir=ee(),lr=(e,t,o)=>ir(e,t,o)<=0;Rt.exports=lr});var Ot=I((Is,Tt)=>{var fr=ue(),cr=(e,t)=>{let o=fr(e,t);return o?o.version:null};Tt.exports=cr});var br={};to(br,{default:()=>Vt});module.exports=oo(br);var tt=L(require("os"),1);var V=e=>{try{if(typeof e=="string"){let t=JSON.parse(e);if(t&&typeof t=="object")return!0}}catch{}return!1};var Ze=require("child_process"),Qe=require("util");var ro=require("@raycast/api");var C=require("@raycast/api"),re=class{toast;abortable;_abortController;constructor(t){this.abortable=t.abortable,this.toast=C.environment.launchType===C.LaunchType.UserInitiated?new C.Toast(t):void 0,this.updateAbortAction()}updateAbortAction(){this.toast&&(this._abortController=this.abortable?new AbortController:void 0,this.toast.primaryAction=this.abortable?{title:"Cancel",onAction:()=>{console.warn("Aborting..."),this._abortController?.abort()}}:void 0)}updateContent(t){if(this.toast){let{title:o,style:r,message:s,secondaryAction:a}=this.toast;this.toast.title=t.title??o,this.toast.style=t.style??r,this.toast.message=t.message??s,this.abortable=t.abortable??this.abortable,this.toast.secondaryAction=t.secondaryAction??a,this.updateAbortAction()}}show(){return this.toast?this.toast.show():Promise.resolve()}hide(){return this.toast?this.toast.hide():Promise.resolve()}get abortController(){return this._abortController}},ae=async e=>{let t=new re(e);return await t.show(),t};var $e=L(require("os"),1);var{username:Tr}=$e.default.userInfo();var se=require("@raycast/api");function h(e){let t=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&t==="[object Date]"?new e.constructor(+e):typeof e=="number"||t==="[object Number]"||typeof e=="string"||t==="[object String]"?new Date(e):new Date(NaN)}function v(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}function ve(e,t){let o=h(e);return isNaN(t)?v(e,NaN):(t&&o.setDate(o.getDate()+t),o)}function Ae(e,t){let o=h(e);if(isNaN(t))return v(e,NaN);if(!t)return o;let r=o.getDate(),s=v(e,o.getTime());s.setMonth(o.getMonth()+t+1,0);let a=s.getDate();return r>=a?s:(o.setFullYear(s.getFullYear(),s.getMonth(),r),o)}function Re(e,t){let{years:o=0,months:r=0,weeks:s=0,days:a=0,hours:f=0,minutes:l=0,seconds:E=0}=t,x=h(e),d=r||o?Ae(x,r+o*12):x,g=a||s?ve(d,a+s*7):d,w=l+f*60,P=(E+w*60)*1e3;return v(e,g.getTime()+P)}function Ne(e,t){let o=+h(e);return v(e,o+t)}var ao=Math.pow(10,8)*24*60*60*1e3,Xr=-ao;var Te=6e4;var so=3600;var Oe=so*24,Vr=Oe*7,no=Oe*365.2425,io=no/12,Jr=io*3;function Le(e,t){return Ne(e,t*Te)}function A(e,t){let o=e<0?"-":"",r=Math.abs(e).toString().padStart(t,"0");return o+r}function Ce(e,t){let o=h(e);if(isNaN(o.getTime()))throw new RangeError("Invalid time value");let r=t?.format??"extended",s=t?.representation??"complete",a="",f="",l=r==="extended"?"-":"",E=r==="extended"?":":"";if(s!=="time"){let x=A(o.getDate(),2),d=A(o.getMonth()+1,2);a=`${A(o.getFullYear(),4)}${l}${d}${l}${x}`}if(s!=="date"){let x=o.getTimezoneOffset();if(x!==0){let O=Math.abs(x),b=A(Math.trunc(O/60),2),q=A(O%60,2);f=`${x<0?"+":"-"}${b}:${q}`}else f="Z";let d=A(o.getHours(),2),g=A(o.getMinutes(),2),w=A(o.getSeconds(),2),S=a===""?"":"T",P=[d,g,w].join(E);a=`${a}${S}${P}${f}`}return a}function ke(e){return h(e*1e3)}function De(e){return Math.trunc(+h(e)/1e3)}function J(e,t){let o=h(e),r=h(t);return o.getTime()>r.getTime()}var R=require("fs"),Pe=require("path"),z=class e{static path=(t,o=!0)=>{let{supportPath:r,commandName:s}=se.environment;return(0,Pe.join)(r,`${o?`${s}-${t}`:t}.json`)};static clear=(t,o)=>{let r=e.path(t,o);return(0,R.existsSync)(r)?((0,R.unlinkSync)(r),!0):!1};static store=(t,o,r={})=>{try{let{appendCommand:s=!0,ttl:a}=r,f=e.path(t,s),l={...a?{ttl:De(Re(new Date,a))}:{},data:o};(0,R.writeFileSync)(f,JSON.stringify(l))}catch{return!1}return!0};static retrieve=(t,o={})=>{let{appendCommand:r=!0}=o,s=e.path(t,r);if(!(0,R.existsSync)(s))return;let a=(0,R.readFileSync)(s,"utf8"),f=JSON.parse(a);if(f.ttl&&J(new Date,ke(+f.ttl))){this.clear(t,r);return}return f.data}};var lo=typeof global=="object"&&global&&global.Object===Object&&global,Me=lo;var fo=typeof self=="object"&&self&&self.Object===Object&&self,co=Me||fo||Function("return this")(),Fe=co;var po=Fe.Symbol,N=po;var je=Object.prototype,mo=je.hasOwnProperty,uo=je.toString,_=N?N.toStringTag:void 0;function ho(e){var t=mo.call(e,_),o=e[_];try{e[_]=void 0;var r=!0}catch{}var s=uo.call(e);return r&&(t?e[_]=o:delete e[_]),s}var Ue=ho;var xo=Object.prototype,go=xo.toString;function yo(e){return go.call(e)}var ze=yo;var Eo="[object Null]",wo="[object Undefined]",Ge=N?N.toStringTag:void 0;function Io(e){return e==null?e===void 0?wo:Eo:Ge&&Ge in Object(e)?Ue(e):ze(e)}var qe=Io;function bo(e){return e!=null&&typeof e=="object"}var We=bo;var So="[object Symbol]";function $o(e){return typeof e=="symbol"||We(e)&&qe(e)==So}var He=$o;function vo(e,t){for(var o=-1,r=e==null?0:e.length,s=Array(r);++o<r;)s[o]=t(e[o],o,e);return s}var _e=vo;var Ao=Array.isArray,Be=Ao;var Ro=1/0,Xe=N?N.prototype:void 0,Ve=Xe?Xe.toString:void 0;function Je(e){if(typeof e=="string")return e;if(Be(e))return _e(e,Je)+"";if(He(e))return Ve?Ve.call(e):"";var t=e+"";return t=="0"&&1/e==-Ro?"-0":t}var Ye=Je;function No(e){return e==null?"":Ye(e)}var ne=No;function To(e){for(var t=-1,o=e==null?0:e.length,r=0,s=[];++t<o;){var a=e[t];a&&(s[r++]=a)}return s}var ie=To;var Ke=e=>e instanceof Error?e.message:ne(e);var u=(0,Qe.promisify)(Ze.exec),U=e=>typeof e=="object"&&"stderr"in e?e.stderr:Ke(e);var et=`${tt.default.homedir()}/.midway/cookie`,Oo=e=>typeof e=="object"&&e!==null&&"__type"in e&&e.__type.includes("Exception"),Lo=e=>typeof e=="object"&&e!==null&&"status"in e&&e.status==="error",Co=(e,t)=>{let{cookie:o,data:r,args:s=[],headers:a={},method:f,maxBuffer:l,cancel:E}=t,x=[`curl -sSL '${e}'`,`-X ${f??"GET"}`,Object.entries(a).map(([d,g])=>`-H '${d}: ${g}'`),s,r?[`-d '${JSON.stringify(r)}'`]:[],o?[`-b '${Object.entries(o).map(([d,g])=>`${d}=${g}`).join(";")}'`]:[]].flat();return u(x.join(" "),{maxBuffer:l,signal:E?.signal}).then(({stdout:d})=>V(d)?JSON.parse(d):d).catch(d=>{throw new Error(U(d))})};var k=(e,t={})=>{let{ignoreCoralError:o=!1,writeToCookieFile:r=!0,args:s=[],...a}=t,f=[s,`--anyauth --location-trusted -k -u : -b ${et}`,r?[`-c ${et}`]:[]].flat();return Co(e,{...a,args:f}).then(l=>{if(!o&&Oo(l))throw new Error(`${l.__type}${l.message?`: ${l.message}`:""}`);if(Lo(l))throw new Error(`${l.message??"Midway Error"}: ${l.desc??"You should authenticate (may use mwinit)"}`);return l})};var ko=(e,t)=>k("https://gitfarm-sso.corp.amazon.com",{...t,method:"POST",headers:{"Content-Encoding":"amz-1.0","Content-Type":"application/json; charset=UTF-8","X-Amz-Target":`com.amazon.brazil.gitfarm.service.GitFarmService.${e}`}}),ot=e=>ko("getReferenceSha1s",{data:{repositoryId:e}}).then(t=>t.references);var Y=require("@raycast/api");function K(e,t=!0){let{launchType:o,extensionName:r,commandName:s}=Y.environment;return!t||o===Y.LaunchType.Background?Promise.resolve():k("https://analytics.raycast.tools.aws.dev/v2/stats",{method:"POST",headers:{"Content-Type":"application/json; charset=UTF-8"},data:{commandName:s,extensionVersion:e,extensionName:r}}).catch(a=>console.warn(`Failed to publish stats for ${r}/${s}.`,a))}var p=require("@raycast/api"),kt=require("child_process");var y=require("fs");var te=L(require("os"),1),D=require("path"),he=L(wt(),1),Dt=L($t(),1),Pt=L(At(),1),xe=L(Nt(),1),Mt=L(Ot(),1);var Ft=e=>{try{return!e||!(0,y.existsSync)(e)||!(0,y.lstatSync)(e).isDirectory()?!1:((0,y.accessSync)(e,y.constants.W_OK),!0)}catch{return!1}},jt=e=>{let t=(0,D.join)(p.environment.assetsPath,e);if(!(0,y.existsSync)(t))return;let o=(0,y.readFileSync)(t,{encoding:"utf8"});return V(o)?JSON.parse(o):void 0},Ut="workspace-config.json",zt=()=>jt(Ut)?.workspacePath,pr=()=>{let e=zt(),t=e&&(0,D.join)(e,"../../..");return Ft(t)?t:void 0},ge="artifact-extr-config.json",Gt=()=>{let e=jt(ge)?.artifactExtrPath;return Ft(e)?e:void 0},qt=e=>ot(`pkg/${e}`).then(t=>ie(t).map(o=>(o.name.match(/refs\/tags\/(.*)/)??["",""])[1]).filter(o=>(0,Mt.default)(o))).then(t=>t.length===0?void 0:t.reduce((o,r)=>(0,Dt.default)(r,o)?r:o,t[0])).catch(t=>{console.warn(`Failed to get the latest extension version for ${e}.`,t)});var ye="status-v3",Lt=e=>{z.store(ye,e)},dr=()=>z.retrieve(ye),Ct=()=>z.clear(ye),Wt=async({mode:e,...t})=>e==="artifact"?ur(t):mr(t),mr=async e=>{let{currentVersion:t,workspaceName:o,pkg:r,tmpOutputPath:s}=e,a="\u{1F516} Fetching the latest version...",f=await ae({style:p.Toast.Style.Animated,title:a}),l=await qt(r);if(!l){f.updateContent({style:p.Toast.Style.Failure,title:"\u274C Failed to get the latest version."});return}if((0,xe.default)(l,t)){f.updateContent({style:p.Toast.Style.Success,title:`\u{1F389} ${l} is the latest version.`}),await(0,p.updateCommandMetadata)({subtitle:`\u{1F389}  up to date with ${l}`});return}await(0,p.updateCommandMetadata)({subtitle:`\u2728  new version ${l} available!`});let E=new Date,x=E.getTime(),d=dr(),g=(d?.retryAttempts||0)+1,w=5;if(d){if((0,Pt.default)(d.version,l)||d.status==="in-progress"&&J(E,Le(new Date(d.timestamp),30)))d=void 0,Ct();else if(d.status==="in-progress"){a=`Update in progress for the latest version ${l}. Please wait and retry later.`,f.updateContent({style:p.Toast.Style.Failure,title:a});return}}let S="brazil",P=`${S}-build`,O=te.default.homedir(),b=["/usr/gnu/bin","/usr/local/bin","/opt/homebrew/bin","/bin","/usr/bin",".",`${O}/.toolbox/bin`,`${O}/.local/share/rtx/shims`,`${O}/.local/share/mise/shims`,`${O}/.asdf/shims`].join(":"),q=pr();if(!q){a=`\u274C Failed to update extension from source code, as ${q} is invalid.`,f.updateContent({title:a,style:p.Toast.Style.Failure});return}let M=(0,D.join)(q,o),W=(0,D.join)(M,"src",r),H=`sudo -u ${te.default.userInfo().username}`,we=`${s}/update-extension.txt`;await u(`mkdir -p ${s}`);let m=$=>`${$} 2>&1 | tee -a ${we}`,F=$=>`(${m($)}; exit \${PIPESTATUS[0]};)`;a="\u{1F44B} Starting extension update process...",f.updateContent({title:a,style:p.Toast.Style.Animated,abortable:!0,message:`Progress can be tracked by tailing ${we}`});try{if(await u([m(`echo "${a}"`),m(`echo "    Start time: ${Ce(E)}"`),m(`echo "    Current version: ${(0,he.default)(t)}"`),m(`echo "    Latest version: ${(0,he.default)(l)}"`),m(`echo "    Retry Attempts: ${g} / ${w}"`)].join(" && "),{env:{PATH:b}}),!d||d.status==="failed"&&g<=w||p.environment.launchType===p.LaunchType.UserInitiated){Lt({version:l,status:"in-progress",timestamp:x,retryAttempts:g}),await(0,p.updateCommandMetadata)({subtitle:`\u{1F6A7}  updating extension to ${l}...`}),a=`\u{1F527} Initializing workspace for ${l}...`,f.updateContent({title:a}),await u([m(`echo "${a}"`),F(`[[ -d "${M}" ]] || ${H} ${S} ws create -r ${M} -vs AmznRaycastExtension/development`),m('echo "\u{1F37B} Workspace initialized successfully!"')].join(" && "),{signal:f.abortController?.signal,env:{PATH:b}}),a="\u{1F504} Syncing workspace...",f.updateContent({title:a}),await u([`cd ${M}`,m(`echo "${a}"`),F(`${H} ${S} ws --sync --md`),m(`echo "\u{1F37B} Workspace ${o} synced successfully!"`)].join(" && "),{signal:f.abortController?.signal,env:{PATH:b}}),a="\u{1F47E} Cloning extension package...",f.updateContent({title:a}),await u([`cd ${M}`,m(`echo "${a}"`),F(`[[ -d "${W}" ]] || ${H} ${S} ws use -p ${r}`),m(`echo "\u{1F37B} Extension package ${r} cloned successfully!"`)].join(" && "),{signal:f.abortController?.signal,env:{PATH:b}}),a=`\u{1F516} Switching to the latest version (${l})...`,f.updateContent({title:a}),await u([`cd ${W}`,m(`echo "\u{1F516} Fetching the latest version for ${r}..."`),F("git fetch"),m(`echo "${a}"`),F(`git checkout "refs/tags/${l}" -b ${l}-${x}`),m(`echo "\u{1F37B} Switched to latest version ${l} successfully!"`)].join(" && "),{signal:f.abortController?.signal,env:{PATH:b}});let $=async(j,B)=>{a=B,f.updateContent({title:a}),await u([`cd ${W}`,m(`echo "${B}"`),F(`${H} ${P} ci --omit=dev ${j?"--prefer-offline":""}  --no-audit`),m('echo "\u{1F37B} Dependencies installed successfully!"')].join(" && "),{signal:f.abortController?.signal,env:{PATH:b}})};try{await $(!0,"\u{1F4E6} Installing dependencies...")}catch(j){if(f.abortController?.signal.aborted)throw j;console.warn("Failed to install deps: ",j),await $(!1,'\u{1F4E6} Retrying dependencies installation without "--prefer-offline"...')}let Ie=Gt();Ie&&(0,y.writeFileSync)(`${W}/assets/${ge}`,JSON.stringify({artifactExtrPath:Ie})),a="\u{1F6A7} Deploying the latest changes in development mode...",f.updateContent({title:a}),await u(m(`echo "${a}"`),{env:{PATH:b}}),await new Promise((j,B)=>{let oe=(0,kt.spawn)([`cd ${W}`,`${H} ${P} run dev`].join(" && "),{shell:!0,signal:f.abortController?.signal,env:{PATH:b},timeout:12e3});oe.stdout.on("data",be=>{be.toString().includes("built extension successfully")&&oe.kill("SIGUSR1")}),oe.on("exit",(be,Jt)=>{Jt==="SIGUSR1"?j():B(new Error("Failed to deploy the latest changes in development mode."))})}),await u([m('echo "\u2728 You are up to update!"'),m('echo "    For any issues you encounter, please refer to "'),m('echo "      https://w.amazon.com/bin/view/UsingRaycast/AmznRaycastExtension/InstallFromSourceCode#HTroubleshooting"')].join(" && "),{env:{PATH:b}}),f.updateContent({style:p.Toast.Style.Success,title:`\u2728 Updated extension to ${l}.`,abortable:!1}),await(0,p.updateCommandMetadata)({subtitle:`\u{1F389}  up to date with ${l}`}),Ct()}}catch($){console.error("Failed to update extension: ",$),a=`\u274C Failed to update extension to ${l}.`,f.updateContent({style:p.Toast.Style.Failure,title:a,message:U($),abortable:!1}),Lt({timestamp:x,version:l,status:"failed",retryAttempts:g}),await u(m(`echo "${a}"`),{env:{PATH:b}}),await(0,p.updateCommandMetadata)({subtitle:`\u{1F480}  failed to update extension to ${l}`})}},ur=async e=>{let{currentVersion:t,pkg:o,tmpOutputPath:r,workspaceName:s}=e,a="\u{1F516} Fetching the latest version...",f=await ae({title:a,style:p.Toast.Style.Animated,abortable:!1}),l=await qt(o);if(!l)f.updateContent({style:p.Toast.Style.Failure,title:"\u274C Failed to get the latest version."});else if((0,xe.default)(l,t))f.updateContent({style:p.Toast.Style.Success,title:`\u{1F389} ${l} is the latest version.`}),await(0,p.updateCommandMetadata)({subtitle:`\u{1F389}  up to date with ${l}`});else if(await(0,p.updateCommandMetadata)({subtitle:`\u2728  new version ${l} available!`}),p.environment.launchType===p.LaunchType.UserInitiated)try{let E=Date.now(),x=`${l}-${E}.zip`,d=(0,D.join)(r,x);a="\u{1F4E5} Retrieving the source code zip file for extension...",f.updateContent({title:a,abortable:!0}),await u(`mkdir -p ${r}`),await k(`https://code.amazon.com/packages/${o}/blobs/mainline/--/archives/latest.zip/?download=1`,{args:[`-o ${d}`],cancel:f.abortController});let g=Gt()??te.default.homedir(),w=(0,D.join)(g,s);a=`\u{1F4E6} Extracting the source code zip file to ${w}/latest...`,f.updateContent({title:a,abortable:!1}),await u(`mkdir -p ${w} && unzip -q -o ${d} -d ${w}/latest`,{signal:f.abortController?.signal}),(0,y.writeFileSync)(`${w}/latest/assets/${ge}`,JSON.stringify({artifactExtrPath:g}));let S=zt();S&&(0,y.writeFileSync)(`${w}/latest/assets/${Ut}`,JSON.stringify({workspacePath:S})),await u(`rm -f ${d}`),a=`\u{1F4C2} Launching "Import Extension" to access the ${w}/latest directory...`,f.updateContent({title:a}),await(0,p.launchCommand)({name:"import-extension",extensionName:"developer",ownerOrAuthorName:"raycast",type:p.LaunchType.UserInitiated}),await(0,p.updateCommandMetadata)({subtitle:`\u{1F389}  up to date with ${l}`})}catch(E){console.error("Failed to update extension: ",E),a=`\u274C Failed to update extension to ${l}.`,f.updateContent({style:p.Toast.Style.Failure,title:a,message:U(E),abortable:!1})}};var Ht="1.18.4";var Ee=Ht,xr="AmznRaycastExtension",gr=".managed-amzn-raycast-do-not-modify-or-delete",yr="managed-amzn-raycast-do-not-delete",Er="/tmp/amzn-raycast-extension";var _t=e=>Wt({currentVersion:Ee,pkg:xr,tmpOutputPath:Er,mode:e,workspaceName:e==="artifact"?yr:gr});var wr=()=>K(Ee,!0),Bt=wr;var Xt=require("@raycast/api"),{"extension-update-method":Ir}=(0,Xt.getPreferenceValues)();async function Vt(){await Bt(),await _t(Ir)}
/*! Bundled license information:

lodash-es/lodash.js:
  (**
   * @license
   * Lodash (Custom Build) <https://lodash.com/>
   * Build: `lodash modularize exports="es" -o ./`
   * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
   * Released under MIT license <https://lodash.com/license>
   * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
   * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
   *)
*/
